# Wave 3 â€” Rendering and JS Runtime Deep Dive

## FindingRecord

| id | subsystem | scope | status | severity | criticality | evidence | spec_citation | certainty | source_wave | notes | resolution_hint |
|---|---|---|---|---|---|---|---|---|---|---|
| W3-FS-01 | from_scratch | `src/html/html_parser.cpp` | Partial | High | High | `src/html/html_parser.cpp:238-508` | WHATWG HTML parsing | High | Wave 3 | Ad-hoc parser loop replaces full tokenizer+state machine. | Implement full tokenizer state machine and malformed-markup recovery tests. |
| W3-FS-02 | from_scratch | `include/browser/html/dom.h`, `src/js/runtime.cpp` | Partial | High | High | `include/browser/html/dom.h:11-33`, `src/js/runtime.cpp:520-757` | DOM specification | High | Wave 3 | DOM and event model is limited to simple node/query/text helper usage. | Expand DOM and mutation APIs to spec-like API envelope. |
| W3-FS-03 | from_scratch | `src/layout/layout_engine.cpp`, `src/render/renderer.cpp` | Partial | Medium | Medium | `src/layout/layout_engine.cpp:151-455`, `src/render/renderer.cpp:1468-1654` | Layout and paint | Medium | Wave 3 | Rendering is present but not a full paint/compositing model. | Implement full invalidation and stacking/compositing semantics. |
| W3-FS-04 | from_scratch | `include/browser/js/runtime.h`, `src/js/runtime.cpp` | Missing | High | High | `src/js/runtime.cpp:1155-1181`, `include/browser/js/runtime.h:43-78` | ECMAScript scheduling | High | Wave 3 | No queueing/RAF/workers implemented. | Add task model and deterministic queue ordering tests. |
| W3-CL-01 | clever | `clever/src/html/tree_builder.cpp` | Partial | Medium | Medium | `clever/src/html/tree_builder.cpp:295-788` | HTML tree builder | Medium | Wave 3 | Simplified insertion behavior leaves spec edge cases incomplete. | Extend insertion-mode coverage and edge-case corpus. |
| W3-CL-02 | clever | `clever/src/js/js_dom_bindings.cpp` | Partial | Medium | Medium | `clever/src/js/js_dom_bindings.cpp:211-240`, `clever/src/js/js_dom_bindings.cpp:5205-5387` | DOM binding/query/events | Medium | Wave 3 | Binding scope covers common APIs but not full selector/event surfaces. | Add combinators/attribute selectors and event semantics. |
| W3-CL-03 | clever | `clever/src/layout/layout_engine.cpp`, `clever/src/paint/render_pipeline.cpp` | Partial | Medium | Medium | `clever/src/layout/layout_engine.cpp:1080-1130`, `clever/src/paint/render_pipeline.cpp:10128-10145`, `clever/src/paint/render_pipeline.cpp:10377-10392` | Layout/paint | Medium | Wave 3 | Simplified inline/layout flattening and layered handling. | Expand cascade/layout correctness and overflow order tests. |
| W3-CL-04 | clever | `clever/src/js/js_timers.cpp`, `clever/src/js/js_window.cpp`, `clever/src/paint/render_pipeline.cpp` | Partial | High | High | `clever/src/js/js_timers.cpp:50-125`, `clever/src/js/js_window.cpp:228-301`, `clever/src/paint/render_pipeline.cpp:10958-11024` | Event loop | High | Wave 3 | Callback execution tied to manual pipeline flush, not full event-loop lifecycle. | Introduce autonomous scheduler with consistent macrotask/microtask/RAF phase ordering. |
