# Missing Components Criticality Map

| id | component | subsystem | missing element | severity | criticality | evidence | notes | resolution_hint |
|---|---|---|---|---|---|---|---|
| MC-01 | Full WHATWG tokenization/parse recovery | from_scratch | Advanced tokenizer state machine, foreign-content insertion, script/rawtext/error recovery | High | Engine integrity | `src/html/html_parser.cpp:238-508` | Custom parser does not implement the full HTML tokenizer/tree-construction surface. | Implement spec-aligned tokenizer/tree-builder transitions and recovery for malformed markup. |
| MC-02 | DOM API coverage | from_scratch | Rich DOM APIs, event dispatch, mutation/event APIs | High | Compatibility | `include/browser/html/dom.h:11-33`; `src/js/runtime.cpp:520-757` | Runtime DOM surface is intentionally lightweight; no full DOM interface layer. | Expand host object model to include full query/mutation/event APIs used in standard pages. |
| MC-03 | HTML parser/state parity | clever | Insertion-mode/adoption/foster coverage | High | Rendering correctness | `clever/src/html/tree_builder.cpp:295-788`; `audit/wave1/wave1b-clever-architecture.md:1` | Parser has dedicated token/tree stages but simplified handling for table and malformed markup. | Expand parser state coverage and add parser corpus gating. |
| MC-04 | WebIDL + host binding generation | both | Spec-driven binding generation pipeline | High | Standards compatibility | `clever/src/js/js_dom_bindings.cpp:1-200`; `include/browser/js/runtime.h:1`; `CLEVER_ENGINE_BLUEPRINT.md:1166-1214` | Bindings are handcrafted instead of WebIDL-generated reflection/runtime binding contracts. | Introduce WebIDL-first definitions and generation output integration into runtime builds. |
| MC-05 | JS scheduling model | from_scratch | Microtask/macrotask/RAF/workers | High | JS correctness | `include/browser/js/runtime.h:43-78`; `src/js/runtime.cpp:1155-1181` | No explicit queue model or job scheduling order. | Add event loop phases and promise/job queues with ordering tests. |
| MC-06 | Timer/RAF coupling | clever | Render-loop-coupled scheduling | High | Timing correctness | `clever/src/js/js_timers.cpp:50-125`; `clever/src/js/js_window.cpp:228-301`; `clever/src/paint/render_pipeline.cpp:10958-11024` | Timers and RAF are flushed only during render pipeline passes. | Decouple scheduling from render invocation and add deterministic scheduler tests. |
| MC-07 | Cookie/session policy enforcement | clever | SameSite/partition/secure context checks | High | Security | `clever/src/net/cookie_jar.cpp:31-139` | SameSite is parsed but not enforced on send path. | Enforce SameSite and site-context rules before cookie attachment. |
| MC-08 | CSP / SOP / CORS enforcement | from_scratch | Origin checks, preflight, violation handling | High | Browser security | `include/browser/net/http_client.h:31-125`; `src/net/http_client.cpp:1146-1196` | Policy structs exist but full policy execution surface is absent. | Implement CSP parsing and CORS preflight/response validation integration. |
| MC-09 | TLS certificate verification | from_scratch | Certificate chain trust checks | High | Security | `src/net/http_client.cpp:285-317` | HTTPS connect path lacks explicit verification callback/result enforcement before accept. | Add certificate peer verification and explicit failure handling for unverifiable peers. |
| MC-10 | URL parsing parity | from_scratch | Non-HTTP edge cases and full URL Standard recovery | Medium | Navigation correctness | `include/browser/net/url.h:1-22`; `src/net/url.cpp:268-606` | URL parser is constrained and not full spec breadth (search params, some percent-encoding and non-ASCII cases). | Expand parser/serializer + regression suite for `whatwg-url` edge cases. |
| MC-11 | Fetch response stream/abort semantics | both | Full Fetch/stream lifecycle | High | Fetch correctness | `src/net/http_client.cpp:1023-1078`; `clever/src/js/js_fetch_bindings.cpp:135-205` | No full request-body/stream/abort/progressive consumption model is exposed at host layer. | Implement abort signals, readable body streams, and consistent failure transitions. |
| MC-12 | HTTP/2 / HTTP/3 transport support | both | Protocol negotiation and frame semantics | High | Network robustness | `audit/wave0/third-party-linkage.md:29-44`; `audit/wave0/build-graph.md:1` | Build/linkage artifacts show no H2/H3 transport dependency or ALPN negotiation path. | Add dedicated transport stack strategy before browser-grade network requirements. |
| MC-13 | Private cache separation | clever | Cache-control private context partition | Medium | Security/session state | `clever/src/net/http_client.cpp:58-75`; `clever/src/net/http_client.cpp:637-675` | `Cache-Control: private` is parsed but not consistently blocked in shared cache paths. | Partition or reject private cache entries by context/session. |
| MC-14 | Encoding negotiation | from_scratch | TextEncoder/Decoder selection by header/meta/BOM | Medium | I18N correctness | `src/net/url.cpp:268-318` | No TextDecoder API or negotiation pipeline exists. | Add encoding negotiation and decode APIs with tested fallback behavior. |
| MC-15 | Cross-engine policy telemetry | shared | Structured security event/reporting | Medium | Operational hardening | `include/browser/core/diagnostics.h:17-57`; `include/browser/net/http_client.h:61-69`; `audit/wave1/wave1a-from-scratch-architecture.md:1` | Policy checks exist but do not consistently emit enforcement telemetry. | Emit structured deny/allow diagnostics for all policy failures in request and policy hooks. |

## Priority remediation lane

- P0: MC-01, MC-02, MC-04, MC-05, MC-08, MC-09, MC-11, MC-12, MC-14
- P1: MC-03, MC-06, MC-07, MC-10
- P2: MC-13, MC-15
